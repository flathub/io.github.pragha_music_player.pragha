app-id: io.github.pragha_music_player.pragha
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: pragha
rename-icon: pragha
rename-desktop-file: pragha.desktop
rename-appdata-file: io.github.pragha_music_player.metainfo.xml

finish-args:
  - --share=ipc
  - --share=network
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --filesystem=xdg-music
  - --filesystem=xdg-run/gvfs

cleanup:
  - '*.a'
  - '*.la'
  - /lib/girepository-1.0
  - /lib/pkgconfig
  - /include
  - /share/gir-1.0
  - /share/gtk-doc
  - /share/man

modules:
  - shared-modules/intltool/intltool-0.51.json

  - name: libxfce4ui
    modules:
      - name: libxfce4util
        cleanup:
          - /sbin
        config-opts:
          - --disable-debug
        sources:
          - type: archive
            url: https://archive.xfce.org/src/xfce/libxfce4util/4.18/libxfce4util-4.18.1.tar.bz2
            sha256: 8a52063a5adc66252238cad9ee6997909b59983ed21c77eb83c5e67829d1b01f
            x-checker-data:
              type: anitya
              project-id: 232001
              # to be reactivated when libxfce4ui goes to 4.18
              #stable-only: true
              url-template: https://archive.xfce.org/src/xfce/libxfce4util/$major.$minor/libxfce4util-$version.tar.bz2
      - name: xfconf
        modules:
          - name: xfce4-dev-tools
            cleanup:
              - '*'
            sources:
              - type: archive
                url: https://archive.xfce.org/src/xfce/xfce4-dev-tools/4.19/xfce4-dev-tools-4.19.0.tar.bz2
                sha256: ac9fd11f9749303683d80480dac6bbb91c8bf160d8ea5a794bb4f2041eb61d1d
                x-checker-data:
                  type: anitya
                  project-id: 15888
                  stable-only: true
                  url-template: https://archive.xfce.org/src/xfce/xfce4-dev-tools/$major.$minor/xfce4-dev-tools-$version.tar.bz2
        cleanup:
          - /bin
          - /share/bash-completion
        config-opts:
          - --disable-debug
        sources:
          - type: git
            url: https://gitlab.xfce.org/xfce/xfconf.git
            tag: xfconf-4.18.1
            commit: e2ae99a37d1489ffd821e8cc6fc9c7da1fe9405d
            x-checker-data:
              type: anitya
              project-id: 14854
              stable-only: true
              tag-template: xfconf-$version
    cleanup:
      - /bin
      - /etc
      - /share/icons
      - /share/applications
    config-opts:
      - --disable-debug
    sources:
      - type: archive
        url: https://archive.xfce.org/src/xfce/libxfce4ui/4.18/libxfce4ui-4.18.4.tar.bz2
        sha256: 87eefe797c6d26de3f754de48872faf131f1b5fc93fb88e22f5c7886a842cb4c
        x-checker-data:
          type: anitya
          project-id: 232000
          # to be reactivated when it goes to 4.18
          #stable-only: true
          url-template: https://archive.xfce.org/src/xfce/libxfce4ui/$major.$minor/libxfce4ui-$version.tar.bz2

  - name: taglib
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: archive
        url: https://github.com/taglib/taglib/releases/download/v1.12/taglib-1.12.tar.gz
        sha256: 7fccd07669a523b07a15bd24c8da1bbb92206cb19e9366c3692af3d79253b703

  - name: libcddb
    buildsystem: autotools
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/libcddb/libcddb-1.3.2.tar.bz2
        sha256: 35ce0ee1741ea38def304ddfe84a958901413aa829698357f0bee5bb8f0a223b
        x-checker-data:
          type: anitya
          project-id: 1572
          url-template: https://prdownloads.sourceforge.net/libcddb/libcddb-$version.tar.bz2
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} .

  - name: libcdio
    buildsystem: autotools
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/libcdio/libcdio-2.1.0.tar.bz2
        sha256: 8550e9589dbd594bfac93b81ecf129b1dc9d0d51e90f9696f1b2f9b2af32712b

  - name: libcdio-paranoia
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/rocky/libcdio-paranoia/archive/release-10.2+2.0.1.tar.gz
        sha256: 7a4e257c85f3f84129cca55cd097c397364c7a6f79b9701bbc593b13bd59eb95

  - name: totem-pl-parser
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/totem-pl-parser/3.26/totem-pl-parser-3.26.6.tar.xz
        sha256: c0df0f68d5cf9d7da43c81c7f13f11158358368f98c22d47722f3bd04bd3ac1c
        x-checker-data:
          type: anitya
          project-id: 13163
          url-template: https://download.gnome.org/sources/totem-pl-parser/3.26/totem-pl-parser-$version.tar.xz
    cleanup:
      - /include
      - /share/gtk-doc

  - name: pragha
    sources:
      - type: git
        url: https://github.com/pragha-music-player/pragha
        tag: v1.3.99.1
        commit: 073a20c1907aa5d3cefefe7571e7256934ffc94d
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
      - type: patch
        path: appdata.patch
      - type: shell
        commands:
          - sed -i 's#  <id>io.github.pragha_music_player</id>#  <id>io.github.pragha_music_player.pragha</id>#'
            data/io.github.pragha_music_player.metainfo.xml.in
